<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Creative Calling — A Quiet Path Home</title>
  
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Serif+4:wght@400;600&display=swap" rel="stylesheet">
  
  <!-- Custom CSS -->
  <link rel="stylesheet" href="assets/css/site.css">
</head>
<body>
  <header class="text-center py-5 container" role="banner">
    <h1 class="display-4 mb-4">Come home. Be still. Listen.</h1>
    <p class="text-muted fs-5 mb-3">A gentle invitation to rediscover the One who quietly holds you.</p>
    <p class="fst-italic mb-4">"Be still, and know that I am God." — Psalm 46:10</p>
    <p><a href="#stories" class="btn btn-primary btn-lg rounded-pill">Begin</a></p>
  </header>

  <section id="stories" class="py-5 border-bottom container">
    <h2 class="fs-2 mb-4">Stories That Still Speak</h2>
    <p class="fs-5">From Genesis to Revelation, true stories that point to God's steady love.</p>
  </section>

  <section id="mysticism" class="py-5 border-bottom container">
    <h2 class="fs-2 mb-4">A Word on Wandering</h2>
    <p class="fs-5 lh-lg">Modern ways of self-exaltation promise power but leave the soul thirsty. We point instead toward humility, repentance, and rest.</p>
  </section>

  <section id="testimonies" class="py-5 border-bottom container">
    <h2 class="fs-2 mb-4">Real Stories</h2>
    <p class="fs-5 lh-lg">Accounts of redemption and the quiet work of grace in ordinary lives.</p>
  </section>

  <section id="resources" class="py-5 border-bottom container">
    <h2 class="fs-2 mb-4">Resources</h2>
    <ul class="list-unstyled">
      <li class="mb-4">
        <a href="https://www.mardel.com/bibletranslationguide" 
           target="_blank" 
           rel="noopener"
           class="text-decoration-none fs-5 fw-semibold d-block mb-2">Bible Translation Guide</a>
        <p class="text-muted">Start here! A helpful guide explaining different Bible translations, their reading levels, and translation philosophies to help you choose the right Bible for your needs.</p>
      </li>
      <li class="mb-4">
        <a href="https://www.youversion.com/the-bible-app/" 
           target="_blank" 
           rel="noopener"
           class="text-decoration-none fs-5 fw-semibold d-block mb-2">YouVersion Bible App</a>
        <p class="text-muted">Free Bible app with multiple translations, reading plans, and daily devotionals. Available on all devices.</p>
      </li>
      <li class="mb-4">
        <a href="https://www.blueletterbible.org/" 
           target="_blank" 
           rel="noopener"
           class="text-decoration-none fs-5 fw-semibold d-block mb-2">Blue Letter Bible</a>
        <p class="text-muted">In-depth study tool with Greek/Hebrew lexicon, commentaries, and cross-references. Great for word studies.</p>
      </li>
      <li class="mb-4">
        <a href="https://www.logos.com/" 
           target="_blank" 
           rel="noopener"
           class="text-decoration-none fs-5 fw-semibold d-block mb-2">Logos Bible Software</a>
        <p class="text-muted">Professional Bible study software with extensive library options, original language tools, and academic resources.</p>
      </li>
    </ul>
  </section>

  <section id="prayer" class="py-5 border-bottom container">
    <h2 class="fs-2 mb-4">Need Prayer?</h2>
    <p class="fs-5 mb-4">Fill out the short prompts below and we'll help you shape a prayer. Your prayer stays in your browser — nothing is sent to a server.</p>

    <form id="prayer-form" action="https://formsubmit.co/your@email.com" method="POST">
      <!-- FormSubmit configuration -->
      <input type="hidden" name="_subject" value="🙏 New Prayer Request">
      <input type="hidden" name="_template" value="box">
      <input type="hidden" name="_captcha" value="false">
      <input type="hidden" name="_next" value="https://creativecalling.github.io/thank-you">
      <!-- Prevent spam -->
      <input type="text" name="_honey" class="d-none" aria-hidden="true" tabindex="-1">
      
      <div class="mb-4">
        <label for="who" class="form-label fw-semibold">Who or what is this prayer for?</label>
        <input id="who" name="who" type="text" required
               class="form-control" 
               placeholder="e.g., myself, my friend Anna, my family" />
      </div>

      <div class="mb-4">
        <label for="need" class="form-label fw-semibold">What is the need or concern?</label>
        <input id="need" name="need" type="text" required
               class="form-control" 
               placeholder="e.g., healing, wisdom, provision" />
      </div>

      <div class="mb-4">
        <label for="feeling" class="form-label fw-semibold">How are you feeling about this?</label>
        <input id="feeling" name="feeling" type="text" required
               class="form-control" 
               placeholder="e.g., anxious, grateful, confused" />
      </div>

      <div class="mb-4">
        <label for="promise" class="form-label fw-semibold">Is there a Bible promise or hope you'd lean on (optional)?</label>
        <input id="promise" name="promise" type="text" 
               class="form-control" 
               placeholder="e.g., God's presence, Psalm 23, peace beyond understanding" />
      </div>

      <!-- Secure communication token field -->
      <input type="hidden" name="prayer_token" id="prayer_token">

      <div class="card bg-light mb-4">
        <div class="card-body">
          <div class="form-check">
            <input type="checkbox" id="share-prayer" name="request_followup" class="form-check-input" required>
            <label for="share-prayer" class="form-check-label small">
              Yes, I would like prayer support and follow-up. I understand that my request will be kept confidential 
              and I'll receive a secure way to communicate back and forth about my prayer request.
            </label>
          </div>
        </div>
      </div>

      <div class="d-flex gap-3 flex-wrap mb-4">
        <button type="button" id="preview-btn" class="btn btn-primary rounded-pill">Preview Prayer</button>
        <button type="button" id="copy-btn" class="btn btn-outline-primary rounded-pill" disabled>Copy Prayer</button>
        <button type="submit" id="send-btn" class="btn btn-outline-success rounded-pill">Submit Prayer Request</button>
        <button type="reset" id="reset-btn" class="btn btn-outline-secondary rounded-pill">Reset</button>
      </div>
    </form>

    <div id="prayer-preview" class="card mt-4" aria-live="polite" hidden>
      <div class="card-body">
        <h3 class="fs-4 mb-3">Your Prayer</h3>
        <blockquote id="prayer-text" class="fs-5 lh-lg fst-italic mb-0"></blockquote>
      </div>
    </div>

    <!-- Prayer Management Section (only visible to you) -->
    <div id="prayer-management" class="mt-5 border-top pt-4" hidden>
      <h3 class="fs-2 mb-4">Prayer Management</h3>
      <div class="row g-4" id="prayer-list"></div>

      <template id="prayer-card-template">
        <div class="col-12">
          <div class="card">
            <div class="card-body">
              <div class="d-flex justify-content-between align-items-start mb-3">
                <div>
                  <h4 class="fs-5 fw-bold mb-1"></h4>
                  <p class="text-muted small mb-0 date"></p>
                </div>
                <span class="status-badge badge rounded-pill"></span>
              </div>
              <div class="mb-3">
                <p class="need mb-2"></p>
                <p class="text-muted feeling mb-2"></p>
                <p class="promise fst-italic mb-0"></p>
              </div>
              <div>
                <div class="response-area d-none mb-3">
                  <label class="form-label fw-semibold">Your Response:</label>
                  <textarea class="response-text form-control" 
                            rows="4" placeholder="Write your prayer and thoughts here..."></textarea>
                </div>
                <div class="d-flex gap-2 flex-wrap">
                  <button class="btn btn-outline-primary btn-sm respond-btn">Respond</button>
                  <button class="btn btn-outline-info btn-sm follow-up-btn">Send Follow-up</button>
                  <button class="btn btn-outline-success btn-sm mark-completed-btn">Mark Complete</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </template>
    </div>

    <script>
      (function(){
        // DOM Elements
        const prayerForm = document.getElementById('prayer-form');
        const previewBtn = document.getElementById('preview-btn');
        const copyBtn = document.getElementById('copy-btn');
        const prayerTextEl = document.getElementById('prayer-text');
        const previewWrap = document.getElementById('prayer-preview');
        const tokenInput = document.getElementById('prayer_token');

        // Prayer templates for different situations
        const prayerTemplates = {
          praise: [
            "We praise You for Your faithfulness that never fails.",
            "Your love endures forever, and Your mercies are new every morning.",
            "You are our rock and our fortress, our ever-present help in times of need."
          ],
          comfort: [
            "May Your peace that surpasses all understanding guard their heart and mind.",
            "Let them feel Your presence in a tangible way today.",
            "Wrap them in Your comfort as a shepherd carries a lamb."
          ],
          guidance: [
            "Light their path with Your wisdom and truth.",
            "Show them Your way and guide their steps.",
            "Grant them discernment to know Your will."
          ],
          healing: [
            "We ask for Your healing touch, both physically and spiritually.",
            "Restore what is broken and bring wholeness where there is pain.",
            "Let Your healing presence flow through every part of their being."
          ]
        };

        function getEmotionalResponse(feeling) {
          const emotions = {
            anxious: ["peace that surpasses understanding", "calm in the storm", "rest in Your presence"],
            worried: ["trust in Your provision", "confidence in Your care", "freedom from fear"],
            grateful: ["continued thankfulness", "joy in Your goodness", "appreciation of Your blessings"],
            hopeful: ["strengthened faith", "renewed spirit", "continued hope in Your promises"],
            sad: ["comfort in sorrow", "joy in the morning", "healing for the heartbroken"],
            confused: ["clarity of mind", "wisdom for decisions", "understanding of Your will"]
          };

          // Find the best matching emotion or default to general comfort
          const match = Object.entries(emotions).find(([key]) => 
            feeling.toLowerCase().includes(key)
          );
          return match ? match[1][Math.floor(Math.random() * match[1].length)] : "peace and clarity";
        }

        function composePrayer(values){
          const who = values.who || 'this person';
          const need = values.need || '';
          const feeling = values.feeling || '';
          const promise = values.promise || '';

          const lines = [];
          
          // Opening
          lines.push(`Loving Father,`);
          
          // Random praise element
          lines.push(prayerTemplates.praise[Math.floor(Math.random() * prayerTemplates.praise.length)]);

          // Main prayer content
          if (who) {
            lines.push(`We lift up ${who} to You today.`);
          }

          if (feeling) {
            const emotionalResponse = getEmotionalResponse(feeling);
            lines.push(`As they experience ${feeling}, we pray for ${emotionalResponse}.`);
            lines.push(prayerTemplates.comfort[Math.floor(Math.random() * prayerTemplates.comfort.length)]);
          }

          if (need) {
            lines.push(`We specifically ask for ${need}.`);
            if (need.toLowerCase().includes('heal')) {
              lines.push(prayerTemplates.healing[Math.floor(Math.random() * prayerTemplates.healing.length)]);
            } else {
              lines.push(prayerTemplates.guidance[Math.floor(Math.random() * prayerTemplates.guidance.length)]);
            }
          }

          // Biblical promise or hope
          if (promise) {
            lines.push(`We stand on Your promise of ${promise}, knowing that You are faithful to fulfill Your word.`);
          }

          // Closing
          lines.push(`Thank You for hearing our prayer and for Your constant love that surrounds ${who}.`);
          lines.push('In Jesus\' name, amen.');

          return lines.join('\n\n');
        }

        previewBtn.addEventListener('click', function(){
          const data = new FormData(prayerForm);
          const values = Object.fromEntries(data.entries());
          const prayer = composePrayer(values).trim();
          prayerTextEl.textContent = prayer;
          previewWrap.hidden = false;
          copyBtn.disabled = false;
          copyBtn.classList.remove('opacity-50');
        });

        copyBtn.addEventListener('click', function(){
          const text = prayerTextEl.textContent;
          if(!text) return;
          navigator.clipboard && navigator.clipboard.writeText(text).then(function(){
            copyBtn.textContent = 'Copied';
            setTimeout(()=> copyBtn.textContent = 'Copy Prayer', 2000);
          }, function(){
            // fallback
            const ta = document.createElement('textarea');
            ta.value = text; document.body.appendChild(ta); ta.select();
            try{ document.execCommand('copy'); copyBtn.textContent = 'Copied'; }catch(e){}
            ta.remove();
            setTimeout(()=> copyBtn.textContent = 'Copy Prayer', 2000);
          });
        });

        // Secure prayer request and response management
        const sendBtn = document.getElementById('send-btn');
        const shareCheckbox = document.getElementById('share-prayer');

        // Secure prayer request management system
        const PrayerManager = {
          storageKey: 'prayerRequests',
          tokenKey: 'prayerTokens',

          // Generate a secure token for communication
          generateToken() {
            return Array.from(crypto.getRandomValues(new Uint8Array(32)))
              .map(b => b.toString(16).padStart(2, '0'))
              .join('');
          },

          // Store token mapping
          saveToken(requestId, token) {
            const tokens = JSON.parse(localStorage.getItem(this.tokenKey) || '{}');
            tokens[token] = requestId;
            localStorage.setItem(this.tokenKey, JSON.stringify(tokens));
          },

          // Get request by token
          getRequestByToken(token) {
            const tokens = JSON.parse(localStorage.getItem(this.tokenKey) || '{}');
            const requestId = tokens[token];
            if (!requestId) return null;

            const requests = this.getRequests();
            return requests.find(r => r.id === requestId);
          },
          
          // Initialize storage
          init() {
            if (!localStorage.getItem(this.storageKey)) {
              localStorage.setItem(this.storageKey, JSON.stringify([]));
            }
          },

          // Save new prayer request
          saveRequest(request) {
            const requests = this.getRequests();
            request.id = Date.now().toString();
            request.status = 'new';
            request.dateReceived = new Date().toISOString();
            requests.push(request);
            localStorage.setItem(this.storageKey, JSON.stringify(requests));
            return request.id;
          },

          // Get all prayer requests
          getRequests() {
            return JSON.parse(localStorage.getItem(this.storageKey) || '[]');
          },

          // Update prayer request status and response
          updateRequest(id, updates) {
            const requests = this.getRequests();
            const index = requests.findIndex(r => r.id === id);
            if (index !== -1) {
              requests[index] = { ...requests[index], ...updates };
              localStorage.setItem(this.storageKey, JSON.stringify(requests));
            }
          },

          // Format prayer request for email
          formatEmailBody(request, type = 'initial') {
            if (type === 'initial') {
              return encodeURIComponent(
                `New Prayer Request:\n\n` +
                `For: ${request.who}\n` +
                `Need: ${request.need}\n` +
                `Feeling: ${request.feeling}\n` +
                (request.promise ? `Promise claimed: ${request.promise}\n\n` : '\n') +
                `Generated Prayer:\n${request.prayer}\n\n` +
                `Request ID: ${request.id}\n` +
                `Reply to: ${request.email}`
              );
            } else { // follow-up
              return encodeURIComponent(
                `Prayer Follow-up:\n\n` +
                `Dear friend,\n\n` +
                `I wanted to let you know that I've been praying for your request:\n` +
                `"${request.need}"\n\n` +
                `Here's how I've been praying for you:\n` +
                `${request.responseText || '[Add your personal prayer and thoughts here]'}\n\n` +
                `Would you let me know how you're doing? I'm here to continue praying with you.\n\n` +
                `With care,\n[Your name]`
              );
            }
          }
        };

        // Initialize prayer manager
        PrayerManager.init();

        function updateSendButton() {
          const canSend = shareCheckbox.checked;
          sendBtn.disabled = !canSend;
        }

        shareCheckbox.addEventListener('change', updateSendButton);

        // Enhanced send functionality with prayer tracking
        sendBtn.addEventListener('click', async function() {
          if (!shareCheckbox.checked) return;

          const formData = new FormData(prayerForm);
          const prayer = prayerTextEl.textContent;
          
          // Save prayer request
          const requestData = {
            who: formData.get('who'),
            need: formData.get('need'),
            feeling: formData.get('feeling'),
            promise: formData.get('promise'),
            prayer: prayer
          };

          const requestId = PrayerManager.saveRequest(requestData);
          
          // Create email with tracking ID
          const subject = encodeURIComponent('Prayer Request from Creative Calling');
          const body = PrayerManager.formatEmailBody(requestData);

          // Open email client
          window.location.href = `mailto:your@email.com?subject=${subject}&body=${body}`;

          // Show confirmation
          const originalText = sendBtn.textContent;
          sendBtn.textContent = 'Request Sent!';
          sendBtn.disabled = true;

          // Add response button after sending
          const responseBtn = document.createElement('button');
          responseBtn.className = 'btn btn-outline-info rounded-pill';
          responseBtn.textContent = 'Send Follow-up';
          responseBtn.onclick = () => {
            const responseSubject = encodeURIComponent(`Prayer Follow-up - ${requestData.who}`);
            const responseBody = PrayerManager.formatEmailBody(requestData, 'follow-up');
            window.location.href = `mailto:your@email.com?subject=${responseSubject}&body=${responseBody}`;
            
            // Update request status
            PrayerManager.updateRequest(requestId, {
              status: 'followed-up',
              lastFollowUp: new Date().toISOString()
            });
          };

          // Add response button to form
          setTimeout(() => {
            sendBtn.parentNode.insertBefore(responseBtn, sendBtn.nextSibling);
            sendBtn.textContent = originalText;
            sendBtn.disabled = false;
          }, 3000);
        });

        prayerForm.addEventListener('reset', function(){
          prayerTextEl.textContent = '';
          previewWrap.hidden = true;
          copyBtn.disabled = true;
          sendBtn.disabled = true;
        });

        // Prayer Management Interface
        const managementSection = document.getElementById('prayer-management');
        const prayerList = document.getElementById('prayer-list');
        const template = document.getElementById('prayer-card-template');

        // Show management section with special key combination (Ctrl+Shift+P)
        document.addEventListener('keydown', function(e) {
          if (e.ctrlKey && e.shiftKey && e.key === 'P') {
            managementSection.hidden = !managementSection.hidden;
            if (!managementSection.hidden) {
              refreshPrayerList();
            }
          }
        });

        function refreshPrayerList() {
          const requests = PrayerManager.getRequests();
          prayerList.innerHTML = '';
          
          requests.sort((a, b) => new Date(b.dateReceived) - new Date(a.dateReceived))
                 .forEach(request => {
            const card = template.content.cloneNode(true);
            
            // Fill in prayer request details
            card.querySelector('h4').textContent = request.who;
            card.querySelector('.date').textContent = new Date(request.dateReceived).toLocaleDateString();
            card.querySelector('.need').textContent = request.need;
            card.querySelector('.feeling').textContent = `Feeling: ${request.feeling}`;
            if (request.promise) {
              card.querySelector('.promise').textContent = `Promise: ${request.promise}`;
            }

            // Set status badge
            const badge = card.querySelector('.status-badge');
            badge.textContent = request.status;
            badge.classList.add(
              request.status === 'new' ? 'bg-primary' :
              request.status === 'responded' ? 'bg-success' :
              'bg-secondary'
            );

            // Setup buttons
            const responseArea = card.querySelector('.response-area');
            const responseText = card.querySelector('.response-text');
            const respondBtn = card.querySelector('.respond-btn');
            const followUpBtn = card.querySelector('.follow-up-btn');
            const completeBtn = card.querySelector('.mark-completed-btn');

            respondBtn.onclick = () => {
              responseArea.classList.toggle('d-none');
              if (request.responseText) {
                responseText.value = request.responseText;
              }
            };

            // Save response as you type
            responseText.oninput = () => {
              PrayerManager.updateRequest(request.id, {
                responseText: responseText.value,
                status: 'draft'
              });
            };

            followUpBtn.onclick = () => {
              const responseSubject = encodeURIComponent(`Prayer Follow-up - ${request.who}`);
              const responseBody = PrayerManager.formatEmailBody({
                ...request,
                responseText: responseText.value
              }, 'follow-up');
              
              window.location.href = `mailto:your@email.com?subject=${responseSubject}&body=${responseBody}`;
              
              PrayerManager.updateRequest(request.id, {
                status: 'responded',
                lastFollowUp: new Date().toISOString(),
                responseText: responseText.value
              });

              refreshPrayerList();
            };

            completeBtn.onclick = () => {
              PrayerManager.updateRequest(request.id, {
                status: 'completed',
                dateCompleted: new Date().toISOString()
              });
              refreshPrayerList();
            };

            prayerList.appendChild(card);
          });
        }
      })();
    </script>
  </section>

  <footer class="container py-5">
    <div class="text-center">
      <p class="small mb-3">© 2025 Creative Calling — A quiet path home</p>
      <div class="d-flex justify-content-center gap-3 flex-wrap">
        <a href="#stories" class="text-decoration-none small">Stories</a>
        <a href="#mysticism" class="text-decoration-none small">Wandering</a>
        <a href="#testimonies" class="text-decoration-none small">Testimonies</a>
        <a href="#resources" class="text-decoration-none small">Resources</a>
      </div>
    </div>
  </footer>

  <!-- Back to top button -->
  <button 
    onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
    class="position-fixed bottom-0 end-0 m-4 btn btn-primary rounded-circle shadow-lg"
    style="width: 3rem; height: 3rem;"
    aria-label="Scroll to top">
    ↑
  </button>

  <!-- Bootstrap 5 JS Bundle -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>